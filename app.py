import streamlit as st
from Feature_Extraction import GetHeader, CreateDataframe
from utils import*




#Setting webpage configuration
st.set_page_config(page_title = "Malware Detection",
                   layout="wide",
                   initial_sidebar_state="expanded",
                   page_icon="üêû")

st.title("Malware Detection Using Machine Learning")

# Setting Background Image
main_bg = "items/background.png"
set_bg_hack(main_bg)

#Uploaded box element
uploaded_file = st.file_uploader(
    "Upload Exe file to check whether the exe is malicious or not", type=["exe"],
    accept_multiple_files=False)


if uploaded_file is not None:
    # File processing function call here
    file_content = uploaded_file.read()      # Read the content of the uploaded file
    
    #Generating PE
    pe = GetPE(file_content)
    df = CreateDataframe(GetHeader(pe=pe),file_content)
    df = df.drop(columns=["TimeDateStamp","SHA256"], axis=1)
    
    
    #Creating container
    with st.container():
        st.write("---")
        
        #Creating two columns
        left_column, right_column = st.columns(2)
    
        #Designing left_column
        with left_column:
            st.subheader('Extracted Features', divider='rainbow')
            st.write(df)
            
            #Loading predict model
            model = load_object("items/Catboost2OverSmote.pkl")
            
            #Making prediction
            prediction = model.predict(df)
            st.subheader('Prediction :', divider='rainbow')
            
            
            if prediction==0:
                st.write("**The file is predicted as Benign.**")
            else:
                st.write("**The file is predicted as Malicious.**")
        
        #Designing right column        
        with right_column:
            predictions = model.predict_proba(df)
            class_probabilities = predictions[0]
            st.subheader("Probablity Distriution between classes", divider='rainbow')
            Makegraph(class_probabilities)
            
            
        
    
