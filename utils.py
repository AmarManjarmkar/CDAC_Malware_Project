import pickle
import pefile
from io import BytesIO
import streamlit as st
import base64
import matplotlib.pyplot as plt
import pandas as pd
import seaborn as sns

def GetPE(file_content):

    # Create a BytesIO object to work with file content as binary data
    file_stream = BytesIO(file_content)

    # Read the content from the BytesIO object
    file_content = file_stream.read()

    # Create a PE object using the actual file content
    pe = pefile.PE(data=file_content)

    return pe


def set_bg_hack(main_bg):
    '''
    A function to unpack an image from root folder and set as bg.
 
    Returns
    -------
    The background.
    '''
    # set bg name
    main_bg_ext = "png"
        
    st.markdown(
         f"""
         <style>
         .stApp {{
             background: url(data:image/{main_bg_ext};base64,{base64.b64encode(open(main_bg, "rb").read()).decode()});
             background-size: cover
         }}
         </style>
         """,
         unsafe_allow_html=True)
    
    
def load_object(file_path):
    with open(file_path, "rb") as file_obj:
        return pickle.load(file_obj)
    
    
def Makegraph(class_probabilities):
    class_labels = ['Benign','RedLineStealer',
                            'Downloader','RAT',
                            'SnakeKeyLogger','Spyware']
            
    data_list = []
    for i, label in enumerate(class_labels):
        data_list.append({'Class': label, 'Probability': class_probabilities[i]})
    new_df = pd.DataFrame(data_list)
            
    sns.set()
    plt.figure(figsize=(10, 6))
    ax = sns.barplot(x='Class', y='Probability', data=new_df, label=True)
    return st.pyplot(plt)