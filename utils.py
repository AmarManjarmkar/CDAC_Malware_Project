import pickle
import pefile
from io import BytesIO
import streamlit as st
import base64
import matplotlib.pyplot as plt
import pandas as pd
import seaborn as sns
import plotly.express as px
import plotly.graph_objects as go

def GetPE(file_content):
    # Create a PE object using the actual file content
    pe = pefile.PE(data=file_content)

    return pe


def set_bg(main_bg):
    '''
    A function to unpack an image from root folder and set as bg.
 
    Returns
    -------
    The background.
    '''
    # set bg name
    main_bg_ext = "png"
        
    st.markdown(
         f"""
         <style>
         .stApp {{
             background: url(data:image/{main_bg_ext};base64,{base64.b64encode(open(main_bg, "rb").read()).decode()});
             background-size: cover
         }}
         </style>
         """,
         unsafe_allow_html=True)
    
    
def load_object(file_path):
    with open(file_path, "rb") as file_obj:
        return pickle.load(file_obj)
    



def Makegraphplotly(class_probabilities):
    # class_labels = ['Benign', 'RedLineStealer', 'Downloader', 'RAT', 'SnakeKeyLogger', 'Spyware']
    class_labels = ['Benign', 'Malware']

    data_list = []
    for i, label in enumerate(class_labels):
        data_list.append({'Class': label, 'Probability': class_probabilities[i]})
        
    new_df = pd.DataFrame(data_list)

    fig = px.pie(new_df, values='Probability', names='Class', hole=0.5, title='Class Probabilities')
    
    fig.update_traces(textfont_size=18,
                      marker=dict(line=dict(color='#000000', width=2)))
    
    fig.update_layout(title_font=dict(size=24))

    st.plotly_chart(fig)
